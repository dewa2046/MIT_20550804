<!DOCTYPE html>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/ClientSide/html.html to edit this template
-->
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>ATM DashBoard</title>
        <link rel = "shortcut icon" href = "images/dashboardLogo.ico"/>
        <!-- Meta Tags -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <link href="css/font-awesome.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet" type="text/css" />        
        <link href="css/bootstrap.css" rel="stylesheet" type="text/css">

        <link href="jQueryAssets/jquery.ui.core.min.css" rel="stylesheet" type="text/css">
        <link href="jQueryAssets/jquery.ui.theme.min.css" rel="stylesheet" type="text/css">
        <link href="jQueryAssets/jquery.ui.slider.min.css" rel="stylesheet" type="text/css">

        <script src="jQueryAssets/jquery-1.11.1.min.js" type="text/javascript"></script>
        <script src="jQueryAssets/jquery.ui-1.10.4.slider.min.js" type="text/javascript"></script>
        <script src="jQueryAssets/jquery.min.js" type="text/javascript"></script>
        <script src="jQueryAssets/modernizr.js" type="text/javascript"></script>
        <script src="jQueryAssets/bootstrap.min.js"></script>

        <script>
            let atmVal = "";

            $(window).on('load', function () {
                $(".se-pre-con").fadeOut("slow");
                $('#modelLoad').load("Modal.html");

                try {
                    var user = sessionStorage.getItem("UName");
                    var userBr = sessionStorage.getItem("UBr");
                    var userLvl = sessionStorage.getItem("ULvl");

                    if (user == null) {
                        window.location.replace("Login.html");
                    } else {
                        var arrayrecord_data = [userBr, userLvl];
                        getAllATMDetails(arrayrecord_data);
                    }

                } catch (e) {
                    alertBox('Error! - ' + e, 'e');
                }

            });

            function loadAllATMDetails(jason_data) {

                try {
                    var unit = jason_data.data;
                    var size = unit.length;
                    var select = document.getElementById("atmlist");
                    var option;
                    for (var i = 0; i < size; i++) {
                        option = document.createElement('option');
//                        option.text = unit[i]["BR_CODE"] + " - " + unit[i]["BR_NAME"];
                        option.text = unit[i]["ATM_NAME"] + " - " + unit[i]["BR_NAME"] + "(" + unit[i]["BR_CODE"] + ")";
                        option.value = unit[i]["ATM_NAME"] + "~" + unit[i]["BR_CODE"]
                                + "~" + unit[i]["BR_NAME"] + "~" + unit[i]["LOCATION"]
                                + "~" + unit[i]["MODEL_NAME"] + "~" + unit[i]["VENDER_NAME"];
                        select.add(option);
                    }

                } catch (e) {
                    alertBox('Error! - ' + e);
                }

            }

            async function getDetails(val) {

                try {
                    $(".se-pre-con").fadeIn("slow");
                    await sleep(1000);
                    clearLabelValues('conDetails');

                    var divContact = document.getElementById("conDetails");
                    divContact.style.display = "block";

                    atmVal = val.split("~")[0].trim();
                    addLabels('lblAtm', 'ATM NAME', val.split("~")[0]);
                    addLabels('lblLocation', 'LOCATION', val.split("~")[3]);
                    addLabels('lblModel', 'MODEL', val.split("~")[4]);
                    addLabels('lblVender', 'VENDER', val.split("~")[5]);

                    var arrayrecord_data = [val.split("~")[0].trim()];
                    getATMContactDetails(arrayrecord_data);

                    $(".se-pre-con").fadeOut("slow");
                } catch (e) {
                    alertBox('Error! - ' + e, 'e');
                }
            }

            //load Contact Details Level
            function loadATMContactDetails(jason_data) {
                try {
                    clearTable('tblATMContact');
                    var unit = jason_data.data;
                    var size = unit.length;
                    if (size > 0) {
                        addRows('r1td1', unit[0]["PF_1"]);
                        addRows('r1td2', unit[0]["OFFICER_1"]);
                        addRows('r1td3', unit[0]["GRADE_1"]);
                        addRows('r1td4', unit[0]["TEL_MOB_1"]);
                        addRows('r1td5', unit[0]["TEL_EXT_1"]);

                        addRows('r2td1', unit[0]["PF_2"]);
                        addRows('r2td2', unit[0]["OFFICER_2"]);
                        addRows('r2td3', unit[0]["GRADE_2"]);
                        addRows('r2td4', unit[0]["TEL_MOB_2"]);
                        addRows('r2td5', unit[0]["TEL_EXT_2"]);

                        addRows('r3td1', unit[0]["PF_3"]);
                        addRows('r3td2', unit[0]["OFFICER_3"]);
                        addRows('r3td3', unit[0]["GRADE_3"]);
                        addRows('r3td4', unit[0]["TEL_MOB_3"]);
                        addRows('r3td5', unit[0]["TEL_EXT_3"]);

                        addLabels('lblUpdatedBy', 'LAST UPDATED BY', unit[0]["USER_NAME"]);
                        addLabels('lblUpdated', 'LAST UPDATED ON', unit[0]["LAST_UPDATED"].substring(0, unit[0]["LAST_UPDATED"].length - 2));



                    }

                } catch (e) {
                    alertBox('Error! - ' + e);
                }
            }

            function addLabels(labelid, texthilight, val) {

                if (!val) {
                    val = "";
                }
                var label = document.getElementById(labelid);
                var span = document.createElement('span');
                span.classList.add('highlight');
                span.textContent = texthilight;
                var additionalSpan = document.createElement('span');
                additionalSpan.textContent = "   " + val;
                additionalSpan.classList.add('nonhighlight');
                label.appendChild(span);
                label.appendChild(additionalSpan);
            }

            function addRows(tdid, val) {
                var rtd = document.getElementById(tdid);
                if (!val) {
                    val = "";
                }
                var rtdText = document.createTextNode(val);
                rtd.appendChild(rtdText);
            }

            function clearLabelValues(divId) {
                var div = document.getElementById(divId);
                var labelElements = div.getElementsByTagName('label');
                for (var i = 0; i < labelElements.length; i++) {
                    labelElements[i].innerHTML = '';
                }
            }

            function addupdateContacts() {

                try {
                    let table = document.getElementById("tblATMContact");

                    let columnIndex1 = 3;
                    let columnIndex2 = 4;

                    for (let i = 1; i < table.rows.length; i++) {
                        let row = table.rows[i];
                        let cell = row.cells[columnIndex1];
                        let cel2 = row.cells[columnIndex2];

                        let phoneNumber1 = cell.textContent.trim();
                        let phoneNumber2 = cel2.textContent.trim();

                        if (phoneNumber1) {
                            if (!validatePhoneNumber(phoneNumber1)) {
                                alertBox("&#10060 Invalid Mobile Number: " + phoneNumber1, 'e');
                                return;
                            }
                        }

                        if (phoneNumber2) {
                            if (!validatePhoneNumber(phoneNumber2)) {
                                alertBox("&#10060 Invalid Extention Number: " + phoneNumber2, 'e');
                                return;
                            }
                        }
                    }

                    let cellValues = [];

                    cellValues.push(atmVal);
                    for (let i = 1; i < table.rows.length; i++) {
                        let row = table.rows[i];

                        for (let j = 0; j < row.cells.length; j++) {
                            let cell = row.cells[j];
                            cellValues.push(cell.textContent.trim().toUpperCase());
                        }
                    }

                    cellValues.push(sessionStorage.getItem("UId"));
//                    let outputDiv = document.getElementById("output");
//                    var output = cellValues.join(",");
//                    outputDiv.textContent = "Table Cell Values: " + output;

                    alertBoxConfirm('&#9889 Do you want to Add/Update ?');
                    $('#yesbtn').on("click", function () {
                        addUpdateATMContacts(cellValues);
                    });

                } catch (e) {
                    alertBox('Error! - ' + e);
                }
            }

            async function loadAddUpdateATMContacts(jason_data) {

                try {
                    $(".se-pre-con").fadeIn("fast");
                    await sleep(1000);
                    var unit = jason_data.data;
                    var size = unit.length;
                    $(".se-pre-con").fadeOut("slow");
                    if (size > 0) {
                        alertBox('&#9989 ATM Contact Details Added/Updated!', 's');

                        $('#okbtn').on("click", function () {
                            window.location.reload();
                        });
//                        //refresh after 5sec
//                        window.setTimeout(function () {
//                            window.location.reload();
//                        }, 5000);
                    } else {
                        alertBox('&#10060 Error in Creating New Entry!', 'e');
                    }
//                    window.location.reload();

                } catch (e) {
                    alertBox('Error! - ' + e, 'e');
                }

            }

        </script>



        <style>
            #tblATMContact{
                text-align: left;
            }

            #conDetails label{
                padding-right: 10px;
                float: left;
            }
            #tblATMContact td[contenteditable="true"] {
                /*background-color: lightblue;  Apply style to editable cells */
            }
            #tblATMContact td{
                text-transform: uppercase;
            }
            .highlight {
                background-color: #003953;
                color: white;
                padding: 5px;
            }
            .nonhighlight {
                background-color: #000000;
                color: white;
                padding: 5px;
            }

        </style>
    </head>
    <body>
        <div class="se-pre-con"></div>

        <!--Load Modal.html-->
        <div id="modelLoad"></div>

        <h1 id="hed"><img src="images/back.png" alt="Back"  title="Back" onclick="setBack('homeNew.html')"> ATM Contact Details</h1>

        <div class="feedback-w3layouts"> 
            <div class="container" >
                <table class="table table-bordered table-responsive" id="tblHeader" >
                    <tr>
                        <td> 
                            <label><i class="fa fa-caret-square-o-right" aria-hidden="true" ></i> SELECT ATM </label>
                        </td>
                        <td>
                            <div class="input-group">
                                <select class="form-control" id="atmlist" required onchange="getDetails(this.value)">
                                    <option value="">Please Select an Option</option>                                    
                                </select>
                            </div>
                        </td>
                    </tr>

                </table>
                <div class="clear"></div>

                <div id="conDetails" style="display:none">
                    <label id="lblAtm">  </label>
                    <label id="lblLocation">  </label>
                    <label id="lblModel">  </label>
                    <label id="lblVender">  </label>

                    <div class="clear"></div>

                    <!--<h5 style="background-color: #ffffff00;text-align:left;">CONTACT DETAILS</h5>-->
                    <hr>
                    <table class="table table-bordered table-responsive" id="tblATMContact">
                        <thead>
                            <tr>
                                <th>PF NO</th>
                                <th>NAME</th>
                                <th>GRADE</th>
                                <th>MOBILE</th>   
                                <th>EXT</th>
                            </tr>
                        </thead>
                        <tbody id="tblATMContactBody">
                            <tr>
                                <td  contenteditable="true" id="r1td1"></td>
                                <td  contenteditable="true" id="r1td2"></td>
                                <td  contenteditable="true" id="r1td3"></td>
                                <td  contenteditable="true" class="numeric" id="r1td4"></td>
                                <td  contenteditable="true" class="numeric" id="r1td5"></td>
                            </tr>
                            <tr>
                                <td  contenteditable="true" id="r2td1"></td>
                                <td  contenteditable="true" id="r2td2"></td>
                                <td  contenteditable="true" id="r2td3"></td>
                                <td  contenteditable="true" class="numeric" id="r2td4"></td>
                                <td  contenteditable="true" class="numeric" id="r2td5"></td>
                            </tr>
                            <tr>
                                <td  contenteditable="true" id="r3td1"></td>
                                <td  contenteditable="true" id="r3td2"></td>
                                <td  contenteditable="true" id="r3td3"></td>
                                <td  contenteditable="true" class="numeric" id="r3td4"></td>
                                <td  contenteditable="true" class="numeric" id="r3td5"></td>
                            </tr>
                        </tbody>

                    </table>                    
                    <div class="clear"></div>
                    <input type="button" id="addupdate" value="Add/update"  style="float:center;width: 45%;margin: 5px;padding: 0.5em;" onclick="addupdateContacts()">
                    <hr>
                    <div class="clear"></div>

                    <label id="lblUpdatedBy">  </label>
                    <label id="lblUpdated">  </label>


                </div>
            </div>

        </div>
        <script>
// Get all td elements with the 'numeric' class
            var numericCells = document.querySelectorAll('#tblATMContact td.numeric');

// Attach keydown event listeners to each numeric td element
            numericCells.forEach(function (cell) {
                cell.addEventListener('keydown', function (event) {
                    // Allow only numeric input
                    if (!(/[0-9]/.test(event.key) || event.key === 'Backspace' || event.key === 'Delete' || event.key === 'ArrowLeft' || event.key === 'ArrowRight' || event.key === 'Tab')) {
                        event.preventDefault();
                    }
                    if (cell.textContent.length >= 10 && event.key !== 'Backspace' && event.key !== 'Delete' && event.key !== 'ArrowLeft' && event.key !== 'ArrowRight' && event.key !== 'Tab') {
                        event.preventDefault();
                    }
                    var phoneNumber = cell.textContent.trim();
                    var phoneRegex = /^0\d{9}$/;
                    // Check if the entered phone number matches the format
                    if (phoneRegex.test(phoneNumber)) {
                        // Valid phone number format
                        cell.style.color = 'green';
                    } else {
                        // Invalid phone number format
                        cell.style.color = 'red';
                    }
                });
            });
        </script>
        <script src="../ATMDashBoard/js/Services.js"></script>
        <script src="../ATMDashBoard/js/Common.js"></script>
    </body>
</html>
